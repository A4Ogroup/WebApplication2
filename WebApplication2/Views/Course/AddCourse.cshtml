@using System.Security.Claims

@{
    var id = User.FindFirstValue(System.Security.Claims.ClaimTypes.NameIdentifier);

}

@model AddCourseViewModel

@{
    Layout = "_Layout";
}
@{
    var CategoriesList = new SelectList(ViewBag.Categories, "CategoryId", "CategoryName");
    var LanguageList = new SelectList(ViewBag.Languages, "LanguageId", "Name");
}






<head>

    @*     <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">

    <title>Learn consult</title>



    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet">





    <link href="~/css/site.css" rel="stylesheet">
    <link href="~/css/site1.css" rel="stylesheet">
    <link href="~/css/site2.css" rel="stylesheet">
    <link href="~/css/site3.css" rel="stylesheet">
    <link href="~/css/site4.css" rel="stylesheet">
    <link href="~/css/StyleSheet.css" rel="stylesheet"> *@
    <style>


        #subcategoriesList .dropdown-item {
            padding: 5px;
            cursor: pointer; /* make it clear items are clickable */
        }

            #subcategoriesList .dropdown-item:hover {
                background-color: #f0f0f0; /* hover effect for better user experience */
            }



        option {
            background: white; /* Option background */
            color: black;
            cursor: pointer;
        }

            option:after {
                background-color: #f0f0f0; /* hover effect for better user experience */
            }

        .custom-select {
            appearance: none; /* this is important to remove default select arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            padding: 0.375rem 1.75rem 0.375rem 0.75rem;
            font-size: 1rem;
            border: 1px solid gray;
            border-radius: 0.25rem;
            line-height: 1.5;
            background-color: #fff;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg width="12" height="12" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h12L6 12z" fill="%23FF0000"/></svg>'), linear-gradient(to bottom, #ffffff 0%,#e9ecef 100%);
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 12px 12px;
        }

            .custom-select:focus {
                border-color: red;
                outline: none;
                box-shadow: 0 0 0 0.25rem rgba(255, 0, 0, 0.5);
            }

        .banner-item-1 {
            padding: 50px 0px;

            background-repeat: no-repeat;
            background-position: center center;
        }

        /* Custom styling for the select element */
        /*   .custom-select {
                    appearance: none; /* Removes default browser styling */


        /* Adjust padding for the select wrapper to position the arrow correctly */
        /* .select-wrapper {
                    position: relative;
                } */
    </style>

</head>




@*
        <body>

        <div id="preloader">
        <div class="jumper">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div> *@

@*     <header class="">
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">

                <a class="navbar-brand" href="index.html">
                    <h2><em>L</em>earn Consult</h2>
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="nav-item" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                        <!--   <li class="nav-item dropdown">
                               <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                   Category
                               </a>
                               <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                   <li><a class="dropdown-item" asp-controller="home" asp-action="Category">Action</a></li>
                                   <li><a class="dropdown-item" asp-controller="home" asp-action="Category">Another action</a></li>
                                   <li><a class="dropdown-item" asp-controller="home" asp-action="Category">Something else here</a></li>
                               </ul>
                           </li>-->

                        <li class="text-end pe-4 me-4 border-dark search-btn">
                            <div class="search-form">
                                <form method="post" action="index.html">
                                    <div class="form-group">
                                        <div class="d-flex">
                                            <input type="search" class="form-control border-0 rounded-pill" name="search-input" value="" placeholder="Search Here" required="" />
                                            <button><i class="fa fa-search btn"></i></button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </li>

                        <li class="nav-item ">
                            <a class="nav-link" asp-controller="Instructor" asp-action="MyCourses">
                                My Courses
                            </a>
                        </li>



                        <li class="nav-item ">
                            <a class="nav-link" asp-controller="Instructor" asp-action="AddCourse">
                                Add Course
                            </a>
                        </li>

                        <li class="nav-item">
                            <a asp-controller="Home" asp-action="Index" class="nav-link" >Signout</a>
                        </li>
                        <li class="nav-item">
                            <a asp-controller="Instructor" asp-action="Profile" class="nav-link" >Profile</a>
                        </li>
                    </ul>

                </div>
            </div>

        </nav>
    </header> *@

@* @{
    Layout = "_InstructorLayout";
} *@

<div class="banner header-text">
    <div class="owl-banner owl-carousel">
        <div class="banner-item-1">
        </div>
    </div>
</div>




<div class="send-message" style="margin-top:-75px;">
    <div class="container">
       
        <form enctype="multipart/form-data" asp-controller="Course" id="addCourseDynamicForm" asp-action="Addcourse" method="post">
          
            <div asp-validation-summary="All" class="text-danger"></div> 
            
            <div class="row">
                <div class="col-md-12">
                    <div class="section-heading">
                        <h2>Course Info</h2>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="contact-form">

                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                   <label>Course Name</label>
                                    <input asp-for="Title" class="form-control" placeholder="course name">
                                    <span asp-validation-for="Title" class="text-danger"></span>
                                </fieldset>
                            </div>



                            <!-- category dropdown region -->
                            <!-- Category dropdown region -->
                            <div class="col-lg-12 col-md-12 col-sm-12" style="margin-top:30px !important">
                            <fieldset>
                                <div class="form-group mb-4">
                                    <label>Category</label>
                                    <select id="categoriesDropdown" asp-for="CategoryId" asp-items="CategoriesList" onchange="updateSubcategories(this.value)" style="border: 1px solid #e9ecef; border-radius: 0.25rem;" class="form-select mr-sm-2">
                                        <option value="">Select a Category &#9660;</option>
                                    </select>
                                    <span class="text-danger" asp-validation-for="CategoryId"></span>
                                </div>
                            </fieldset>
                            </div>
                            <!-- Subcategory dropdown region -->
                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                    <label>Subcategory</label>
                                    <div class="dropdown form-group mb-4" style="border: 1px solid #e9ecef; border-radius: 0.25rem;">
                                        <a class="dropdown-toggle form-control" id="dropdownMenuLink" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            Select a Subcategory
                                        </a>
                                        <ul id="subcategoriesList" class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                            <!-- Dynamic subcategory items will be added here -->
                                        </ul>
                                    </div>
                                    <input type="hidden" asp-for="SubcategoryId" id="selectedSubcategoryId" />
                                </fieldset>
                            </div>





                            <!-- language dropdown region -->
                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                    <div class="form-group mb-4">
                                        <label>Language</label>
                                        <select id="languageDropdown" asp-for="LanguageId" asp-items="LanguageList" style="border: 1px solid #e9ecef; border-radius: 0.25rem;" class="form-select mr-sm-2">
                                            <option value="">Select Course Language &#9660;</option>
                                        </select>
                                        <span class="text-danger" asp-validation-for="LanguageId"></span>

                                    </div>
                                </fieldset>
                            </div>





                            <!-- Last Update   region -->

                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                    <label>Last update</label>
                                    <input asp-for="LastUpdate" type="date" class="form-control" placeholder="Course last update">
                                    <span class="text-danger" asp-validation-for="LastUpdate"></span>

                                </fieldset>
                            </div>




                            @* <div class="form-group dropdown">
                            <label for="providerInput" class="control-label">Provider</label>
                            <input type="text" id="providerInput" name="Provider" class="form-control" autocomplete="off" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <div id="providerList" class="dropdown-menu" aria-labelledby="providerInput" style="width: 100%;"></div>
                            </div> *@

                            <div class="col-lg-12 col-md-12 col-sm-12">

                                <fieldset>
                                    <label>Platform</label>
                                    <input asp-for="Platform"  class="form-control"  placeholder="Platform">
                                    <span class="text-danger" asp-validation-for="Platform"></span>



                                </fieldset>

                            </div>


                            @*  <div class="col-lg-12 col-md-12 col-sm-12">
                            <fieldset>
                            <ul class=" dropdown">
                            <a class="dropdown-toggle form-control" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Platform
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                            </ul>
                            </ul>
                            </fieldset>
                            </div> *@



                            <!-- Coourse link    region -->
                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                    <label>Link</label>
                                    <input asp-for="Link"  class="form-control"  placeholder="Course link ">
                                    <span class="text-danger" asp-validation-for="Link"></span>

                                </fieldset>
                            </div>



                            <!--Instructor Full Name-->
                            @if (User.IsInRole("Instructor"))
                            {
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <fieldset>
                                        <label asp-for="InstructorFullName">Instructor Full Name</label>
                                        <input asp-for="InstructorFullName" class="form-control" placeholder="Instructor Full Name" value="@ViewBag.InstructorName" readonly>
                                        <span class="text-danger" asp-validation-for="InstructorFullName"></span>

                                    </fieldset>
                                </div>
                            }
                            else
                            {
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <fieldset>
                                        <label>Instructor Full Name</label>
                                        <input asp-for="InstructorFullName" class="form-control" placeholder="Instructor Full Name" >
                                        <span class="text-danger" asp-validation-for="InstructorFullName"></span>

                                    </fieldset>
                                </div>
                            }


                        </div>

                        @*  </form> *@
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="contact-form">
                        @*  <form id="contact" action="" method="post"> *@
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12">







                                <!-- course Description   region -->

                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <fieldset>
                                        <div class="form-group">
                                            <label>Course Description</label>
                                            <textarea asp-for="CourseDescription" class="form-control" rows="3" placeholder="Course Description..."></textarea>
                                            <span class="text-danger" asp-validation-for="CourseDescription"></span>

                                        </div>
                                    </fieldset>
                                </div>

                                <div id="inputContainer" class="col-lg-12 col-md-12 col-sm-12">
                                    <!-- Render initial input field via partial view -->
                                    <span class="text-danger" asp-validation-for="TopicsCovered"></span>
                                    <label>Topics Covered</label>
                                    @Html.Partial("_topicsInputPartialView")

                                </div>
                                <button type="button" onclick="addInput()" class="btn btn-default">+</button>
                                <textarea asp-for="TopicsCovered" hidden></textarea>




                                <!-- course topics covered   region -->
                                @* <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                <input asp-for="TopicsCovered" type="text" class="form-control" id="topicsCovered" placeholder="topics covered" >
                                </fieldset>
                                </div> *@


                            </div>





                            <div class="col-lg-12 col-md-12 col-sm-12">
                            </div>








                            <!-- course Level   region -->


                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                    <div class="form-group mb-4">
                                        <label>Level</label>
                                        <select id="leveldropdown" asp-for="Level" asp-items="Html.GetEnumSelectList<Level>()" style="border: 1px solid #e9ecef; border-radius: 0.25rem;" class="form-select mr-sm-2">
                                            <option value=""> Level &#9660;</option>
                                        </select>
                                        <span class="text-danger" asp-validation-for="Level"></span>

                                    </div>
                                </fieldset>
                            </div>







                            <!-- course price status   region -->
                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                    <div class="form-group mb-4">
                                        <label>Price Status</label>
                                        <select id="pricestatusdropdown" asp-for="PriceStatus" style="border: 1px solid #e9ecef; border-radius: 0.25rem;" class="form-select mr-sm-2">
                                            <option value=""> Price Status &#9660;</option>
                                            <option value="false"> Paid</option>
                                            <option value="true"> Free</option>
                                        </select>
                                        <span class="text-danger" asp-validation-for="PriceStatus"></span>

                                    </div>
                                </fieldset>
                            </div>




                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                    <label>Course Duration</label>
                                    <input asp-for="CourseDuration" type="number" class="form-control"  placeholder="Course Total Hours">
                                    <span class="text-danger" asp-validation-for="CourseDuration"></span>

                                </fieldset>
                            </div>



                            <!-- course price status   region -->







                            <div class="col-lg-12 col-md-12 col-sm-12" style="margin-top:30px !important">
                                <fieldset>
                                    @*                                         <label asp-for="VedioLength"></label>
                                    *@
                                    <div class="form-group mb-4">
                                        <label>video length average</label>
                                        <select id="videolengthaverage" asp-for="VedioLength" asp-items="Html.GetEnumSelectList<VideoLengthCategory>()" style="border: 1px solid #e9ecef; border-radius: 0.25rem;" class="form-select mr-sm-2">
                                            <option value=""> Average Videio Length &#9660;</option>
                                        </select>
                                        <span class="text-danger" asp-validation-for="VedioLength"></span>

                                    </div>
                                </fieldset>
                            </div>


                            <!-- course picture   region -->

                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <fieldset>
                                    <label>Picture</label>
                                    <input asp-for="Picture" type="file" class="form-control" placeholder="Course Poster Image">
                                    <span class="text-danger" asp-validation-for="Picture"></span>
                                </fieldset>
                            </div>
                            @if (User.IsInRole("Instructor"))
                            {
                                <input type="hidden" asp-for="InstructorId" value="@id" />
                            }
                            else if(User.IsInRole("Student")|| User.IsInRole("Admin"))
                            {
                                <input type="hidden" asp-for="AddedByUserId" value="@id" />
                            }
                            
                            
                            <div class="col-lg-12">
                                <fieldset>
                                    <button type="submit" id="contact" class="filled-button mt-4">Submit </button>
                                </fieldset>

                            </div>
                        </div>
                 
            </div>
            </div>
            </div>
       
        </form>

    </div>
   
</div>
           

@section Scripts{

    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>


    
    <script>
        $(document).ready(function () {
            console.log("Document is ready"); // Debugging

            // Handle subcategory selection and update the display and hidden input
            $(document).on('click', '#subcategoriesList .dropdown-item', function () {
                console.log("Document is ready"); // Debugging

                var selectedText = $(this).text();
                var selectedValue = $(this).data('value');
                console.log(selectedText);
                $('#dropdownMenuLink').html(selectedText + ' <span class="caret"></span>'); // Update dropdown link text
                $('#selectedSubcategoryId').val(selectedValue); // Update hidden input value
            });
        });

        function updateSubcategories(categoryId) {
            // Always clear the current subcategories and the selected subcategory display and value
            $('#subcategoriesList').empty();
            $('#dropdownMenuLink').text('Select a Subcategory'); // Reset the button text
            $('#selectedSubcategoryId').val(''); // Clear the hidden input value

            if (categoryId && categoryId != "-1") { // Check if a valid category is selected
                $.ajax({
                    url: '@Url.Action("GetSubcategories", "Course")', // Ensure this matches your MVC routing setup
                    type: 'GET',
                    dataType: 'json',
                    data: { categoryId: categoryId },
                    success: function (data) {
                        if (data.length > 0) {
                            $.each(data, function (i, item) {
                                console.log(item.subName); // Debugging
                                $('<li>')
                                    .append('<a class="dropdown-item" data-value="' + item.subId + '">' + item.subName + '</a>')
                                    .appendTo('#subcategoriesList');
                            });
                        } else {
                            // Optionally, handle when there are no subcategories
                            $('<li>')
                                .append('<a class="dropdown-item" href="">No subcategories available</a>')
                                .appendTo('#subcategoriesList');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("An error occurred: " + error);
                        // Optionally, update UI to reflect the error state
                        $('#dropdownMenuLink').text('Error loading subcategories');
                    }
                });
            } else {
                // If the selected category ID is the default or invalid, clear and show default message
                $('<li>')
                    .append('<a class="dropdown-item" href="#">Select a category first</a>')
                    .appendTo('#subcategoriesList');
            }
        }

    </script>



    <script>


        function addInput() {
            fetch('@Url.Action("InputPartial", "Course")')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('inputContainer').insertAdjacentHTML('beforeend', html);
                });





        }


        document.getElementById('addCourseDynamicForm').addEventListener('submit', function (event) {
            var inputs = document.querySelectorAll('input[name="dynamicInput"]');
            var concatenatedInputs = Array.from(inputs).map(input => input.value).join(';');
            document.getElementById('@Html.IdFor(m => m.TopicsCovered)').value = concatenatedInputs;
        });
    </script>

   }


    @*  <script>
        $(document).ready(function () {
            $("#providerInput").on("input", function () {
                var input = $(this).val();
                var dropdownMenu = $("#providerList");
                if (input.length > 1) {  // Trigger AJAX call when user has typed two or more characters
                    $.ajax({
                        url: '@Url.Action("GetProviders", "Instructor")',  // Adjust controller and action names
                        data: { search: input },
                        success: function (data) {
                            dropdownMenu.empty();
                            if (data.length > 0) {
                                data.forEach(function (item) {
                                    dropdownMenu.append(`<button class="dropdown-item" type="button" onclick="setProvider('${item}')">${item}</button>`);
                                });
                                dropdownMenu.dropdown('show');

                            } else {
                                dropdownMenu.append('<button class="dropdown-item" type="button">No results found</button>');
                                dropdownMenu.dropdown('show');
                               // $("#providerList").append('<a href="#" class="list-group-item">No results found</a>');
                            }
                        }
                    });
                } else {
                    dropdownMenu.empty();
                    dropdownMenu.dropdown('hide');
                }
            });
        });

        function setProvider(name) {
            $("#providerInput").val(name);
            $("#providerList").dropdown('hide');
        }
    </script> *@


@*  <script>
        $(document).ready(function () {
            $('.selectpicker').selectpicker();
        });
    </script> *@
@* <script language="text/Javascript">
    cleared[0] = cleared[1] = cleared[2] = 0; //set a cleared flag for each field
    function clearField(t) {                   //declaring the array outside of the
        if (!cleared[t.id]) {                      // function makes it static and global
            cleared[t.id] = 1;  // you could use true and false, but that's more typing
            t.value = '';         // with more chance of typos
            t.style.color = '#fff';
        }
    }
</script>


  </body> *@

